<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ghana Agriculture Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&family=Open+Sans&display=swap" rel="stylesheet" />

  <!-- MiniMap Plugin -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css" />
<script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>

</head>
<body>
  <div id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <label for="sizeRange">Farm Size (ha): <span id="sizeValue">0</span></label>
<input type="range" id="sizeRange" min="0" max="50" value="0" />
    </div>

    <div class="filters">
      <label for="cropSelect">Crop Type</label>
      <select id="cropSelect">
        <option value="">All Crops</option>
      </select>

      <label for="regionSelect">Region</label>
      <select id="regionSelect">
        <option value="">All Regions</option>
      </select>

      <label for="sizeRange">Farm Size (ha)</label>
      <input type="range" id="sizeRange" min="0" max="100" step="1" />

      <button id="resetFilters" class="reset-btn">Reset Filters</button>
    </div>
  </div>

  <div id="map"></div>

  <div id="footer-tag">Made by Victor Morton-Bruce</div>

  <script>
// Initialize map focused on Ashanti Region
const map = L.map('map').setView([6.6, -1.6], 8);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
  attribution: 'Â© OpenStreetMap contributors'
}).addTo(map);

const cropColors = {
  "Maize": "#f9a825",
  "Cassava": "#8bc34a",
  "Cocoa": "#6d4c41",
  "Rice": "#4fc3f7",
  "Tomatoes": "#e53935"
};

let farmsLayer;

// Fetch GeoJSON Data
fetch('data/ashanti_farms_linear_cluster.geojson')
  .then(response => response.json())
  .then(data => {

    // === FIXED DROPDOWN POPULATION ===
const cropSelect = document.getElementById('cropSelect');
const clusterSelect = document.getElementById('regionSelect');

// Extract unique crops and clusters, ignoring empty/duplicate values
const crops = [...new Set(data.features.map(f => f.properties.crop.trim()))];
const clusters = [...new Set(data.features.map(f => f.properties.cluster.trim()))];

// Add "All Crops" at top
cropSelect.innerHTML = '<option value="Ashanti Region">All Crops</option>';
crops.forEach(crop => {
  if (crop && crop !== "") {
    const opt = document.createElement('option');
    opt.value = crop;
    opt.textContent = crop;
    cropSelect.appendChild(opt);
  }
});

// Add default "Ashanti Region" and then unique clusters
clusterSelect.innerHTML = '<option value="Ashanti Region">Ashanti Region</option>';
clusters.forEach(cluster => {
  if (cluster && cluster !== "") {
    const opt = document.createElement('option');
    opt.value = cluster;
    opt.textContent = cluster;
    clusterSelect.appendChild(opt);
  }
});



    clusters.forEach(cluster => {
      const opt = document.createElement('option');
      opt.value = cluster;
      opt.textContent = cluster;
      clusterSelect.appendChild(opt);
    });

    // Add farms to map
    farmsLayer = L.geoJSON(data, {
      style: feature => ({
        color: '#222',
        weight: 0.8,
        fillColor: cropColors[feature.properties.crop] || '#ccc',
        fillOpacity: 0.6
      }),
      onEachFeature: (feature, layer) => {
        const p = feature.properties;
        layer.bindPopup(`
          <strong>${p.farm_name}</strong><br>
          Farmer: ${p.farmer}<br>
          Crop: ${p.crop}<br>
          Cluster: ${p.cluster}<br>
          Area: ${p.area_ha} ha
        `);
      }
    }).addTo(map);

    // Auto-fit to all farms
    map.fitBounds(farmsLayer.getBounds());

    // === FILTERING ===
    const sizeRange = document.getElementById('sizeRange');
    const sizeLabel = document.getElementById('sizeValue');

    function applyFilters() {
      const selectedCrop = cropSelect.value;
      const selectedCluster = clusterSelect.value;
      const sizeThreshold = parseFloat(sizeRange.value);

      sizeLabel.textContent = sizeThreshold; // update numeric display

      farmsLayer.eachLayer(layer => {
        const p = layer.feature.properties;
        const match =
          (selectedCrop === "All Crops" || p.crop === selectedCrop) &&
          (selectedCluster === "Ashanti Region" || p.cluster === selectedCluster)
 &&
          p.area_ha >= sizeThreshold;

        layer.setStyle({
          opacity: match ? 1 : 0,
          fillOpacity: match ? 0.6 : 0
        });
      });
    }

    // Listeners
    cropSelect.addEventListener('change', applyFilters);
    clusterSelect.addEventListener('change', applyFilters);
    sizeRange.addEventListener('input', applyFilters);

    document.getElementById('resetFilters').addEventListener('click', () => {
      cropSelect.value = "All Crops";
      clusterSelect.value = "All Regions";
      sizeRange.value = 0;
      sizeLabel.textContent = "0";
      applyFilters();
    });
  });
  // Add a minimap inset at bottom-right
const miniMapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  minZoom: 0,
  maxZoom: 13
});

const miniMap = new L.Control.MiniMap(miniMapLayer, {
  toggleDisplay: true,
  minimized: false,
  position: 'bottomright'
}).addTo(map);

</script>

</body>
</html>
